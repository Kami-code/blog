<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ikfast-configuration - Ryan &#039;s website</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Ryan&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Ryan&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="​    IKFAST is a very powerful tool when a robot requires inverse kinematic solutions, so it’s necessary for us to config a customized robot ikfast plugin from scratch, which is a basic skill for a ro"><meta property="og:type" content="blog"><meta property="og:title" content="ikfast-configuration"><meta property="og:url" content="https://kami-code.com/2021/11/06/ikfast-configuration/"><meta property="og:site_name" content="Ryan &#039;s website"><meta property="og:description" content="​    IKFAST is a very powerful tool when a robot requires inverse kinematic solutions, so it’s necessary for us to config a customized robot ikfast plugin from scratch, which is a basic skill for a ro"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211104225830618.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211104225910646.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105180248091.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105183615272.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105183557186.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105180712381.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105190442411.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105190609222.png"><meta property="og:image" content="https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105192158984.png"><meta property="article:published_time" content="2021-11-06T03:15:01.000Z"><meta property="article:modified_time" content="2022-01-25T09:51:03.814Z"><meta property="article:author" content="Kami-code"><meta property="article:tag" content="moveit"><meta property="article:tag" content="ikfast"><meta property="article:tag" content="pybullet"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2021/11/06/ikfast-configuration/image-20211104225830618.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kami-code.com/2021/11/06/ikfast-configuration/"},"headline":"ikfast-configuration","image":["https://kami-code.com/2021/11/06/ikfast-configuration/image-20211104225830618.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211104225910646.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105180248091.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105183615272.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105183557186.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105180712381.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105190442411.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105190609222.png","https://kami-code.com/2021/11/06/ikfast-configuration/image-20211105192158984.png"],"datePublished":"2021-11-06T03:15:01.000Z","dateModified":"2022-01-25T09:51:03.814Z","author":{"@type":"Person","name":"Kami-code"},"publisher":{"@type":"Organization","name":"Ryan 's website","logo":{"@type":"ImageObject","url":"https://kami-code.com/img/logo.svg"}},"description":"​    IKFAST is a very powerful tool when a robot requires inverse kinematic solutions, so it’s necessary for us to config a customized robot ikfast plugin from scratch, which is a basic skill for a ro"}</script><link rel="canonical" href="https://kami-code.com/2021/11/06/ikfast-configuration/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Ryan &#039;s website" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-06T03:15:01.000Z" title="2021/11/6 上午11:15:01">2021-11-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-01-25T09:51:03.814Z" title="2022/1/25 下午5:51:03">2022-01-25</time></span><span class="level-item">13 minutes read (About 1911 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ikfast-configuration</h1><div class="content"><p>​    IKFAST is a very powerful tool when a robot requires inverse kinematic solutions, so it’s necessary for us to config a customized robot ikfast plugin from scratch, which is a basic skill for a robotic engineer, I deem. <span id="more"></span></p>
<h2 id="1-Configure-the-ikfast-for-flexiv-robot"><a href="#1-Configure-the-ikfast-for-flexiv-robot" class="headerlink" title="1. Configure the ikfast for flexiv robot"></a>1. Configure the ikfast for flexiv robot</h2><p>​    As <a target="_blank" rel="noopener" href="https://ros-planning.github.io/moveit_tutorials/doc/ikfast/ikfast_tutorial.html">first search</a> shows, the ikfast  is provided by OpenRAVE which is a very complex planning framework. OpenRAVE requires a tricky installing process, and using not supported environment to install it will cause a lot of frustration. Luckily, there is a docker image to help us get rid of such tedious and troublesome work. I fork <a target="_blank" rel="noopener" href="https://hub.docker.com/r/personalrobotics/ros-openrave">the repo</a> to better save the docker image.  The docker image provides Ubuntu 14.04 with OpenRAVE 0.9.0 and ROS Indigo installed, which can be used to generate the solver code once. You can browse the docker image by the following command.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kamicode/personalrobotics:ros-openrave</span><br></pre></td></tr></table></figure>

<p>​    The script in moveit_kinematics which is called auto_create_ikfast_moveit_plugin.sh will automatically build the docker environment and prepare the OpenRAVE.</p>
<p>​    Since we have the robot’s urdf, we can use the following command to create the ikfast plugin.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MYROBOT_NAME=<span class="string">&quot;panda&quot;</span> &amp;</span><br><span class="line">rosrun moveit_kinematics auto_create_ikfast_moveit_plugin.sh --iktype Transform6D <span class="variable">$MYROBOT_NAME</span>.urdf &lt;planning_group_name&gt; &lt;base_link&gt; &lt;eef_link&gt;</span><br></pre></td></tr></table></figure>

<p>​    In my case, the command is</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun moveit_kinematics auto_create_ikfast_moveit_plugin.sh --iktype Transform6D --name flexiv &lt;somewhere&gt;/ws_moveit/src/moveit_resources/flexiv_description/robot.urdf arm base link7</span><br></pre></td></tr></table></figure>

<p>​    I specify the –name attribute, because if I use the absolute path, the auto-extracted name may not be correct.</p>
<p>​    The result after several minute is as follows.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Running &lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/ikfast_kinematics_plugin/scripts/create_ikfast_moveit_plugin.py <span class="string">&quot;flexiv&quot;</span> <span class="string">&quot;arm&quot;</span> <span class="string">&quot;flexiv_arm_ikfast_plugin&quot;</span> <span class="string">&quot;base&quot;</span> <span class="string">&quot;link7&quot;</span> <span class="string">&quot;/tmp/ikfast.rn0uJk/.openrave/kinematics.f82de3cf02e1545e44ec052f9f4778ca/ikfast0x10000049.Transform6D.1_2_3_4_5_6_f0.cpp&quot;</span></span><br><span class="line">Creating IKFastKinematicsPlugin with parameters: </span><br><span class="line"> robot_name:           flexiv</span><br><span class="line"> base_link_name:       base</span><br><span class="line"> eef_link_name:        link7</span><br><span class="line"> planning_group_name:  arm</span><br><span class="line"> ikfast_plugin_pkg:    flexiv_arm_ikfast_plugin</span><br><span class="line"> ikfast_output_path:   /tmp/ikfast.rn0uJk/.openrave/kinematics.f82de3cf02e1545e44ec052f9f4778ca/ikfast0x10000049.Transform6D.1_2_3_4_5_6_f0.cpp</span><br><span class="line"> search_mode:          OPTIMIZE_MAX_JOINT</span><br><span class="line"> srdf_filename:        flexiv.srdf</span><br><span class="line"> robot_name_in_srdf:   flexiv</span><br><span class="line"> moveit_config_pkg:    flexiv_moveit_config</span><br><span class="line"></span><br><span class="line">Found <span class="built_in">source</span> code generated by IKFast version 73</span><br><span class="line">Failed to find package: flexiv_arm_ikfast_plugin. Will create it <span class="keyword">in</span> &lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin.</span><br><span class="line">Created ikfast header file at <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/include/ikfast.h&#x27;</span></span><br><span class="line">Created ikfast plugin file at <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/src/flexiv_arm_ikfast_moveit_plugin.cpp&#x27;</span></span><br><span class="line">Created plugin definition at  <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/flexiv_arm_moveit_ikfast_plugin_description.xml&#x27;</span></span><br><span class="line">Created cmake file at <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/CMakeLists.txt&#x27;</span></span><br><span class="line">Wrote package.xml at  <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/package.xml&#x27;</span></span><br><span class="line">Created update plugin script at <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/moveit/moveit_kinematics/flexiv_arm_ikfast_plugin/update_ikfast_plugin.sh&#x27;</span></span><br><span class="line">Modified kinematics.yaml at <span class="string">&#x27;&lt;somewhere&gt;/ws_moveit/src/flexiv_moveit_config/config/kinematics.yaml&#x27;</span></span><br></pre></td></tr></table></figure>

<p>​    Notice the upper script has modified the kinematics.yaml in flexiv_moveit_config, which means the robot will use the ikfast to calculate ik.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">arm:</span></span><br><span class="line">  <span class="attr">kinematics_solver:</span> <span class="string">flexiv_arm/IKFastKinematicsPlugin</span></span><br><span class="line">  <span class="attr">kinematics_solver_search_resolution:</span> <span class="number">0.005</span></span><br><span class="line">  <span class="attr">kinematics_solver_timeout:</span> <span class="number">0.005</span></span><br></pre></td></tr></table></figure>

<p>​    But if we using the following command to visualize the flexiv robot in RViz, we can find an error which means that the moveit can not load the flexiv-ikfast plugin.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch flexiv_moveit_config demo.launch</span><br></pre></td></tr></table></figure>

<p>​    The error is</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] [1636036724.761299732]: The kinematics plugin (arm) failed to load. Error: According to the loaded plugin descriptions the class flexiv_arm/IKFastKinematicsPlugin with base class <span class="built_in">type</span> kinematics::KinematicsBase does not exist. Declared types are  cached_ik_kinematics_plugin/CachedKDLKinematicsPlugin cached_ik_kinematics_plugin/CachedSrvKinematicsPlugin kdl_kinematics_plugin/KDLKinematicsPlugin lma_kinematics_plugin/LMAKinematicsPlugin prbt_manipulator/IKFastKinematicsPlugin srv_kinematics_plugin/SrvKinematicsPlugin</span><br><span class="line">[ERROR] [1636036724.761371349]: Kinematics solver could not be instantiated <span class="keyword">for</span> joint group arm.</span><br></pre></td></tr></table></figure>

<p>​    It tells us that MoveIt can not find the flexiv-ikfast plugin. So we goto the /ws_moveit/src/moveit/moveit_kinematics to find out why.</p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211104225830618.png"></p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211104225910646.png"></p>
<p>​    There is flexiv_arm_ikfast_plugin indeed in the directory, but it seems not be complied. I try to add some lines to the CMakeList.txt in moveit_kinematics directory but failed in compiling. But I find if I copy the flexiv_arm…._plugin out as a single package to compile. Rviz works without informing “plugin not found”.</p>
<h2 id="2-Validate-the-output-ikfast-file-works"><a href="#2-Validate-the-output-ikfast-file-works" class="headerlink" title="2. Validate the output ikfast file works"></a>2. Validate the output ikfast file works</h2><p>​    Because RViz will pick available ik solver if it can not find configured ikfast plugin, even if the error message has been eliminated, we can not make sure that the RViz planing do use the ikfast. We need to find an another way.</p>
<p>​    <a target="_blank" rel="noopener" href="http://wiki.ros.org/Industrial/Tutorials/Create_a_Fast_IK_Solution">An article</a> proposes another way for us. That is, use the ikfastdemo.cpp to do the validation. We can simply put the <a target="_blank" rel="noopener" href="https://github.com/davetcoleman/clam_rosbuild/blob/master/clam_ik/models/ikfastdemo.cpp">ikfastdemo.cpp</a> in the same directory with our ikfast cpp, and make ikfastdemo.cpp inlcude it.</p>
<p>​    So we add two lines to ikfastdemo.cpp.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IK_VERSION 73</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;flexiv_arm_ikfast_solver.cpp&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>​    And compile it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ ikfastdemo.cpp -lstdc++ -llapack -o compute -lrt</span><br></pre></td></tr></table></figure>

<p>​    The usage is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Usage: </span><br><span class="line"></span><br><span class="line">./compute fk j0 j1 ... j6 </span><br><span class="line">Returns the forward kinematic solution given the joint angles (in radians). </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./compute ik  t0 t1 t2  qw qi qj qk  free0 ... </span><br><span class="line">Returns the ik solutions given the transformation of the end effector specified by a 3x1 translation (tX), and a 1x4 quaternion (w + i + j + k). There are 1 free parameters that have to be specified. </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">./compute ik  r00 r01 r02 t0  r10 r11 r12 t1  r20 r21 r22 t2  free0 ... </span><br><span class="line">Returns the ik solutions given the transformation of the end effector specified by a 3x3 rotation R (rXX), and a 3x1 translation (tX). There are 1 free parameters that have to be specified. </span><br><span class="line"></span><br><span class="line">./compute iktiming </span><br><span class="line">For fixed number of iterations, generates random joint angles, then calculates fk, calculates ik, measures average time taken. </span><br><span class="line"></span><br><span class="line">./compute iktiming2 </span><br><span class="line">For fixed number of iterations, with one set of joint variables, this finds the ik solutions and measures the average time taken. </span><br></pre></td></tr></table></figure>

<h3 id="2-1-Painful-debug-time"><a href="#2-1-Painful-debug-time" class="headerlink" title="2.1 Painful debug time"></a>2.1 Painful debug time</h3><p>I use the following command to calculate a forward kinematic solution.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./compute fk 1.57 1.57 1.57 1.57 1.57 1.57 1.57</span><br><span class="line"></span><br><span class="line">Found fk solution <span class="keyword">for</span> end frame: </span><br><span class="line">  Translation:  x: -0.484689  y: 0.475605  z: 0.400080  </span><br><span class="line">  </span><br><span class="line">     Rotation     0.001591   0.001596   -0.999997  </span><br><span class="line">       Matrix:    0.999996   0.002387   0.001595  </span><br><span class="line">                  0.002390   -0.999996   -0.001592  </span><br><span class="line"></span><br><span class="line"> Euler angles: </span><br><span class="line">       Yaw:   -1.572388    (1st: rotation around vertical blue Z-axis <span class="keyword">in</span> ROS Rviz) </span><br><span class="line">       Pitch: 1.568409  </span><br><span class="line">       Roll:  0.001595  </span><br><span class="line"></span><br><span class="line">  Quaternion:  -0.500596   0.500199   0.500597   -0.498606   </span><br><span class="line">               -0.500596 + 0.500199i + 0.500597j - 0.498606k   (alternate convention) </span><br></pre></td></tr></table></figure>

<p>​    To visualize the solution in the RViz, I set the flexiv robot at the same configuration, and add a box indicating the calculation of the ikfast forward kinematics.</p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105180248091.png"></p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105183615272.png"></p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105183557186.png"></p>
<p>​    It seems the base joint need to rotate 180 degree to fit the result of ikfast fk, which is very weird. I spend a lot of time debugging on the problem. What remains unknown is that the RViz motion planning plugin still works well though the ikfast is not giving the correct answer. So it may not use ikfast or experience some downgrade mode because the failure of finding a solution by ikfast plugin.</p>
<p>​    By chance, I find that the yaw angle of the first fixed joint is strange. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ============ joint 0 =============== --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;joint0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 -3.1415927&quot;</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 0.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;world&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;base&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    It is exactly 180 degree, which fits our guess. So I change the value of that yaw angle to zero. And everything works. But what cause the difference? Remember we do NOT set the virtual joint when configuring the flexiv in MoveIt Setup Assistant because we find the fixed joint in URDF ? If we did that as the tutorial, it will add following lines into our robot.srdf.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--VIRTUAL JOINT: Purpose: this element defines a virtual joint between a robot link and an external frame of reference (considered fixed with respect to the robot)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">virtual_joint</span> <span class="attr">child_link</span>=<span class="string">&quot;panda_link0&quot;</span> <span class="attr">name</span>=<span class="string">&quot;virtual_joint&quot;</span> <span class="attr">parent_frame</span>=<span class="string">&quot;world&quot;</span> <span class="attr">type</span>=<span class="string">&quot;floating&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    So BEAR IN MIND, IT IS A CONVENTION  THAT THE VIRTUAL JOINT SHOULD BE WITH RPY=”0 0 0”!!!</p>
<h3 id="2-2-Result"><a href="#2-2-Result" class="headerlink" title="2.2 Result"></a>2.2 Result</h3><p><img src="/2021/11/06/ikfast-configuration/image-20211105180712381.png"></p>
<p>​    Finally, I find both the joint and the box overlap however I change the joint position, which means the forward kinematics of ikfast calculate the correct result !</p>
<h1 id="3-Add-ikfast-into-pybullet-planning-module"><a href="#3-Add-ikfast-into-pybullet-planning-module" class="headerlink" title="3. Add ikfast into pybullet-planning module"></a>3. Add ikfast into pybullet-planning module</h1><p>​    Let’s first have a glance on the directory structure of the pybullet-planning/pybullet_tools/ikfast</p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105190442411.png"></p>
<p>​    We need to add flexiv directory which includes</p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105190609222.png"></p>
<p>The ik.py defines some basic information of our new robot.    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ..utils <span class="keyword">import</span> IKFastInfo</span><br><span class="line"><span class="keyword">from</span> ..ikfast <span class="keyword">import</span> * <span class="comment"># For legacy purposes</span></span><br><span class="line"></span><br><span class="line">FLEXIV_URDF = <span class="string">&quot;models/flexiv_description/flexiv.urdf&quot;</span></span><br><span class="line"></span><br><span class="line">FLEXIV_INFO = IKFastInfo(module_name=<span class="string">&#x27;flexiv.ikfast_flexiv&#x27;</span>, base_link=<span class="string">&#x27;base&#x27;</span>,</span><br><span class="line">                        ee_link=<span class="string">&#x27;link7&#x27;</span>, free_joints=[<span class="string">&#x27;joint1&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>The setup.py helps us to compile a pybind11 module, which a shared library .so file. The code is mainly modified from the existed ikfast robot directory.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">sys.path.append(os.path.join(os.pardir, os.pardir, os.pardir))</span><br><span class="line"><span class="keyword">from</span> pybullet_tools.ikfast.<span class="built_in">compile</span> <span class="keyword">import</span> compile_ikfast</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build C++ extension by running: &#x27;python setup.py&#x27;</span></span><br><span class="line"><span class="comment"># see: https://docs.python.org/3/extending/building.html</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># lib name template: &#x27;ikfast_&lt;robot name&gt;&#x27;</span></span><br><span class="line">    sys.argv[:] = sys.argv[:<span class="number">1</span>] + [<span class="string">&#x27;build&#x27;</span>]</span><br><span class="line">    robot_name = <span class="string">&#x27;flexiv&#x27;</span></span><br><span class="line">    compile_ikfast(module_name=<span class="string">&#x27;ikfast_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(robot_name),</span><br><span class="line">                   cpp_filename=<span class="string">&#x27;ikfast_&#123;&#125;.cpp&#x27;</span>.<span class="built_in">format</span>(robot_name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>​    In the original ikfast_flexiv.cpp, to enable the pybind11, we have to add a lot of functions and include “Python.h”. Luckily the author of pybullet-planning has written it for us, so we only to add <a target="_blank" rel="noopener" href="https://github.com/caelan/pybullet-planning/blob/b7d463e86c96c37bd672918e6bb5e4abc40581b9/pybullet_tools/ikfast/franka_panda/ikfast_panda_arm.cpp#L12835">these lines</a> at the end.</p>
<p>​    Then we simply use the command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$python</span> setup.py build</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">ikfast module ikfast_flexiv imported successful</span><br></pre></td></tr></table></figure>

<p>​    We can modify the test codes in pybullet-planning examples to check whether our flexiv robot can use ikfast to calculate now.</p>
<p><img src="/2021/11/06/ikfast-configuration/image-20211105192158984.png"></p>
<p>​    The result shows we did it ! </p>
<h1 id="4-Drawbacks"><a href="#4-Drawbacks" class="headerlink" title="4. Drawbacks"></a>4. Drawbacks</h1><p>​    When I used ikfast in real application, I found a serious problem that ikfast demanded a high accuracy for the pos and orn of the end-effector. But in practice, due to the observation error and others, many times we just want ikfast to produce a solution with some tolerance rather than output “NO SOLUTION”. But according to my experience and <a href="answers.ros.org/question/356856/tolerance-of-soultion-when-using-ikfast/">this question</a>,  such problem can only solved by randomly sample some 6D pose within our predefined tolerant field manually. But such way will make a high-speed theoretically solvable inverse kinematics solve to be a sample-based ik-solver again and require some wrapper rather than just use the ikfast.cpp file, which becomes cumbersome again. So after consideration, I deem that a theoretically-solvable ik-solve is of more fancy than more use.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>ikfast-configuration</p><p><a href="https://kami-code.com/2021/11/06/ikfast-configuration/">https://kami-code.com/2021/11/06/ikfast-configuration/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Kami-code</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-11-06</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-01-25</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/moveit/">moveit</a><a class="link-muted mr-2" rel="tag" href="/tags/ikfast/">ikfast</a><a class="link-muted mr-2" rel="tag" href="/tags/pybullet/">pybullet</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/11/22/complier-lab4/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">complier-lab4</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/11/05/MoveIt-Setup-Assistant/"><span class="level-item">MoveIt Setup Assistant</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="SOHUCS" sid="2021/11/06/ikfast-configuration/"></div><script charset="utf-8" src="https://changyan.sohu.com/upload/changyan.js"></script><script>window.changyan.api.config({appid: 'cyvI88c19',conf: 'prod_634561f1ec380218934dcf2c12b8b70b'});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="Chen Bao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Chen Bao</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">34</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kami-code" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kami-code"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-29T03:41:38.000Z">2022-01-29</time></p><p class="title"><a href="/2022/01/29/unigrasp/">unigrasp</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-26T10:59:39.000Z">2022-01-26</time></p><p class="title"><a href="/2022/01/26/GIGA/">(RSS2021)GIGA的仿真器部分</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-18T06:33:35.000Z">2022-01-18</time></p><p class="title"><a href="/2022/01/18/GraspNet-1Billion/">(CVPR2020)GraspNet-1Billion</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-17T07:07:22.000Z">2022-01-17</time></p><p class="title"><a href="/2022/01/17/6D-GraspNet/">(ICCV2019)6D-GraspNet</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-17T06:39:59.000Z">2022-01-17</time></p><p class="title"><a href="/2022/01/17/machine-learning-pre/">VoteNet_pre</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/6D-GraspNet/"><span class="tag">6D-GraspNet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CHOMP/"><span class="tag">CHOMP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVPR/"><span class="tag">CVPR</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Camera/"><span class="tag">Camera</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GraspNet/"><span class="tag">GraspNet</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ICCV/"><span class="tag">ICCV</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ICRA/"><span class="tag">ICRA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Neo4j/"><span class="tag">Neo4j</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenCV/"><span class="tag">OpenCV</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenGL/"><span class="tag">OpenGL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PointNet/"><span class="tag">PointNet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PointNet/"><span class="tag">PointNet++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pybind11/"><span class="tag">Pybind11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pybullet/"><span class="tag">Pybullet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROS/"><span class="tag">ROS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RSS/"><span class="tag">RSS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SE3353/"><span class="tag">SE3353</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ScrewNet/"><span class="tag">ScrewNet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Search/"><span class="tag">Search</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VoteNet/"><span class="tag">VoteNet</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebService/"><span class="tag">WebService</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/behavior-tree/"><span class="tag">behavior tree</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compliers/"><span class="tag">compliers</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/deeplearning/"><span class="tag">deeplearning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ikfast/"><span class="tag">ikfast</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lab/"><span class="tag">lab</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mmdection/"><span class="tag">mmdection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/moveit/"><span class="tag">moveit</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/planning/"><span class="tag">planning</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pybullet/"><span class="tag">pybullet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/segmentation/"><span class="tag">segmentation</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Ryan &#039;s website" height="28"></a><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span class="post-meta-divider">|</span><span id="busuanzi_container_site_uv" style="display:none">本站访客数<span id="busuanzi_value_site_uv"></span>人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><p class="is-size-7"><span>&copy; 2022 Kami-code</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>